---
import { getCollection } from "astro:content"

import { transformImage } from "@/lib/transform-image"
import CmsLayout from "@/components/cms/cms-layout"
import CmsPage from "@/components/cms/cms-page"
import Layout from "@/components/layout.astro"

export async function getStaticPaths() {
  const pages = await getCollection("pages")
  return pages.map((page) => {
    return {
      params: {
        cmspage: page.id === "index" ? undefined : page.id,
      },
      props: page,
    }
  })
}

const page = Astro.props

const transformedPage = {
  ...page,
  data: {
    ...page.data,
    image: await transformImage(page.data.image),
  },
}
---

<Layout>
  <CmsLayout
    client:load
    currentPath={Astro.url.pathname}
    site={Astro.site?.hostname}
  >
    <CmsPage client:load {...transformedPage} />
  </CmsLayout>
</Layout>
