---
import { getCollection, getEntry, render } from 'astro:content'
import Footer from 'fulldev-ui/blocks/Footer.astro'
import Header from 'fulldev-ui/blocks/Header.astro'
import Block from 'fulldev-ui/components/Block.astro'
import Element from 'fulldev-ui/components/Element.astro'
import Layout from 'fulldev-ui/structures/Layout.astro'
import { getHref } from 'fulldev-ui/utils/getHref.ts'

export async function getStaticPaths() {
  const collection = await getCollection('pages')
  return collection.map((entry) => ({
    params: {
      href: getHref(entry.id),
    },
    props: entry,
  }))
}

const page = Astro.props.data
const general = (await getEntry('globals', 'general'))?.data
const header = (await getEntry('globals', 'header'))?.data
const footer = (await getEntry('globals', 'footer'))?.data
const { Content, headings } = await render(Astro.props)
---

<Layout
  {...page}
  {...general}
>
  <Header
    {...general}
    {...header}
  />
  <Element as="main">
    <Block
      {headings}
      {...general}
      {...page}
    >
      <Content />
    </Block>
    {
      page.sections?.map((section, i) => (
        <Block
          depth={i === 0 && !page.block && !page.variant ? 1 : 2}
          {...section}
        />
      ))
    }
    <slot />
  </Element>
  <Footer
    {...general}
    {...footer}
  />
</Layout>
