---
import { Font } from "astro:assets"
import { getEntry } from "astro:content"
import config from "fulldev:config"

import { Badge } from "@/components/ui/badge"
import ModeToggleProvider from "@/components/ui/mode-toggle/mode-toggle-provider.astro"
import { Section } from "@/components/ui/section"
import Block from "@/components/block.astro"
import Layout from "@/components/layout.astro"

const allSkeletons = import.meta.glob("src/components/skeletons/**/*.astro", {
  eager: true,
})

const sortedSkeletons = Object.entries(allSkeletons).sort(([a], [b]) => {
  const aId = a.split("/").pop()?.split(".")[0] ?? ""
  const bId = b.split("/").pop()?.split(".")[0] ?? ""
  // Extract numeric parts for proper numeric sorting
  const aNum = parseInt(aId.replace(/\D/g, "")) || 0
  const bNum = parseInt(bId.replace(/\D/g, "")) || 0
  // If both have numbers, compare numerically
  if (aNum && bNum) return aNum - bNum
  // Otherwise, fall back to string comparison
  return aId.localeCompare(bId)
})

const indexLayout = await getEntry("layouts", "index")
---

<Layout
  {...config}
  {...indexLayout?.data.seo}
  title="Skeletons - fulldev/ui"
  description="Browse all available skeleton components"
>
  <Fragment slot="head">
    <ModeToggleProvider />
    <Font cssVariable="--font-base" preload />
    <Font cssVariable="--font-heading" preload />
    <Fragment set:html={indexLayout?.data.head} />
  </Fragment>
  <Block block={indexLayout?.data.header} />
  <Block block={indexLayout?.data.banner} />
  <main class="@container flex flex-col">
    {
      sortedSkeletons.map(([path, skeleton]: [string, any]) => {
        const id = path.split("/").pop()?.split(".")[0]
        const SkeletonComponent = skeleton.default
        return SkeletonComponent ? (
          <Section
            class="@container relative mt-12 mb-0 border-2 border-dashed bg-transparent ring-0"
            variant="panel"
            width="2xl"
            id={id}
          >
            <Badge
              class="absolute top-4 left-4"
              variant="secondary"
              href={`/skeletons/${id}/`}
            >
              {id}
            </Badge>
            <SkeletonComponent />
          </Section>
        ) : null
      })
    }
  </main>
  <Block block={indexLayout?.data.footer} />
  <Fragment set:html={indexLayout?.data.body} />
</Layout>
