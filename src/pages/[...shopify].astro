---
import { getLayout, getPages } from "@/adapters/shopify/api"

import Layout from "@/components/misc/layout.astro"
import Page from "@/components/misc/page.astro"

export async function getStaticPaths() {
  const pages = await getPages()
  return pages.map((page) => ({
    params: {
      shopify: page.slug,
    },
    props: {
      page,
      search: pages.map((page) => ({
        text: page.title,
        href: page.slug ? `/${page.slug}/` : "/",
      })),
    },
  }))
}

const { search, ...props } = Astro.props
const { title, seo, content, ...page } = props.page

const { header, ...layout } = await getLayout()
---

<Layout
  header={{ ...header, cart: true, search }}
  {...layout}
  title={title}
  {...seo}
>
  <Page {...page}>
    <Fragment set:html={content} />
  </Page>
</Layout>
