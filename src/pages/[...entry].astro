---
import { getCollection, render } from "astro:content"
import config from "fulldev.config.json"
import { keys } from "remeda"

import "@/styles/globals.css"

import { getHref } from "@/lib/get-href"
import Layout from "@/components/layout.astro"

export async function getStaticPaths() {
  const collectionKeys = keys(config)
  const entries = await Promise.all(
    collectionKeys.map(async (collectionKey) => {
      const entries = await getCollection(collectionKey)
      return entries.map((entry) => {
        const href = getHref(entry)
        if (href === undefined) return undefined
        return {
          params: {
            entry: href === "/" ? undefined : href,
          },
          props: entry,
        }
      })
    })
  )
  return entries.flat().filter((entry) => entry !== undefined)
}

const { Content } = await render(Astro.props)
const { collection, data } = Astro.props
const block = config[collection].block
---

<Layout block={block} {...data}>
  <Content />
</Layout>
