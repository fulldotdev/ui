---
import { getCollection, render } from "astro:content"

import "@/styles/globals.css"

import { getEntry } from "astro:content"
import { isIndexSignatureDeclaration } from "typescript"

import { getHrefByEntry } from "@/lib/collections"
import Layout from "@/components/layout.astro"

export async function getStaticPaths() {
  const entries = await getCollection("content")
  return entries.map((entry) => {
    const href = getHrefByEntry(entry)
    console.log({ href })
    return {
      params: {
        entry: href === "/" ? undefined : href,
      },
      props: entry,
    }
  })
}

const { Content } = await render(Astro.props)
const { collection, data } = Astro.props

// Get base collection preset and collection-specific preset from collections collection
const layouts = await getCollection("layouts")

// Merge the presets and entry
const merged = {
  ...basePreset?.data,
  ...collectionPreset?.data,
  ...data,
  blocks: [
    ...(data?.blocks ?? []),
    ...(collectionPreset?.data.blocks ?? []),
    ...(basePreset?.data.blocks ?? []),
  ],
}
---

<Layout {...merged}>
  <Content />
</Layout>
