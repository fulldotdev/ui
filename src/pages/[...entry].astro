---
import { getCollection, render } from "astro:content"
import collections from "collections.json"
import { keys } from "remeda"

import "@/styles/globals.css"

import { getHrefByEntry } from "@/lib/collections"
import Layout from "@/components/layout.astro"

export async function getStaticPaths() {
  // Get all entries from all collections
  const collectionKeys = keys(collections)
  const entries = await Promise.all(
    collectionKeys.map(async (collectionKey) => {
      const entries = await getCollection(collectionKey)
      return entries
    })
  )

  // Transform the entries into paths
  return entries.flat().map((entry) => {
    const href = getHrefByEntry(entry)
    return {
      params: {
        entry: href === "/" ? undefined : href,
      },
      props: entry,
    }
  })
}

const { Content } = await render(Astro.props)
const { data } = Astro.props

// Get the block from the collection based on the config
const block = collections[data.collection as keyof typeof collections]?.block
---

<Layout block={block} {...data}>
  <Content />
</Layout>
