---
import { Badge } from "@/components/ui/badge"
import { Section, SectionProvider } from "@/components/ui/section"
import Layout from "@/components/layout.astro"

const allSkeletons = import.meta.glob("src/components/skeletons/**/*.astro", {
  eager: true,
})
const sortedSkeletons = Object.entries(allSkeletons).sort(([a], [b]) => {
  const aId = a.split("/").pop()?.split(".")[0] ?? ""
  const bId = b.split("/").pop()?.split(".")[0] ?? ""
  // Extract numeric parts for proper numeric sorting
  const aNum = parseInt(aId.replace(/\D/g, "")) || 0
  const bNum = parseInt(bId.replace(/\D/g, "")) || 0
  // If both have numbers, compare numerically
  if (aNum && bNum) return aNum - bNum
  // Otherwise, fall back to string comparison
  return aId.localeCompare(bId)
})
---

<Layout
  name="fulldev/ui"
  title="Skeletons - fulldev/ui"
  description="Browse all available skeleton components"
  image={{ src: "placeholder.webp", alt: "Skeletons" }}
>
  <SectionProvider>
    {
      sortedSkeletons.map(([path, skeleton]: [string, any]) => {
        const id = path.split("/").pop()?.split(".")[0]
        const SkeletonComponent = skeleton.default
        return SkeletonComponent ? (
          <Section
            class="@container relative mt-12 mb-0 border-2 border-dashed bg-transparent ring-0"
            variant="panel"
            width="2xl"
            id={id}
          >
            <Badge
              class="absolute top-4 left-4"
              variant="secondary"
              href={`/skeletons/${id}/`}
            >
              {id}
            </Badge>
            <SkeletonComponent />
          </Section>
        ) : null
      })
    }
  </SectionProvider>
</Layout>

<script>
  const searchInput = document.getElementById("search") as HTMLInputElement

  function filterSkeletons(query: string) {
    const skeletons = document.querySelectorAll(".skeleton-preview")
    const searchQuery = query.toLowerCase()

    skeletons.forEach((skeleton) => {
      const skeletonId = (skeleton as HTMLElement).id.toLowerCase()
      const isMatch = skeletonId.includes(searchQuery)
      ;(skeleton as HTMLElement).style.display = isMatch ? "block" : "none"
    })
  }

  searchInput?.addEventListener("input", (e) => {
    const query = (e.target as HTMLInputElement).value
    filterSkeletons(query)
  })

  filterSkeletons("")
</script>
