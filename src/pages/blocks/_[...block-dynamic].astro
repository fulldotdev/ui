---
import { Field, FieldLabel } from "@/components/ui/field"
import { Section, SectionContent, SectionSpread } from "@/components/ui/section"
import { Select, SelectItem } from "@/components/ui/select"
import { Typography } from "@/components/ui/typography"
import Layout from "@/components/layout.astro"

export async function getStaticPaths() {
  const blocks = import.meta.glob("src/components/blocks/**/*.astro")
  console.log({ blocks })
  return Object.entries(blocks).map(([path, value]) => {
    const id = path.split("/").pop()?.split(".")[0]
    return {
      params: {
        block: id,
      },
      props: {
        id,
        value,
        data: {
          frame: "float",
          align: "center",
          variant: "muted",
          size: "default",
          title: "Lorem ipsum dolor sit amet",
          description:
            "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.",
          channels: [
            {
              title: "Bellen",
              description: "06 1234 5678",
              href: "tel:0612345678",
              icon: "phone",
            },
            {
              title: "Email",
              description: "info@example.com",
              href: "mailto:info@example.com",
              icon: "mail",
            },
            {
              title: "Adres",
              description: "1234567890",
              href: "https://maps.app.goo.gl/1234567890",
              icon: "map-pin",
            },
          ],
          image: {
            src: "/placeholder.webp",
            alt: "Review 1",
          },
          form: {
            fields: [
              {
                type: "text",
                name: "name",
                id: "name",
                placeholder: "Name",
                label: "Name",
              },
              {
                type: "email",
                name: "email",
                id: "email",
                placeholder: "Email",
                label: "Email",
              },
              {
                type: "textarea",
                name: "message",
                id: "message",
                placeholder: "Message",
                label: "Message",
              },
              {
                type: "tel",
                name: "phone",
                id: "phone",
                placeholder: "Phone",
                label: "Phone",
              },
              {
                type: "checkbox",
                name: "checkbox",
                id: "checkbox",
                label: "Checkbox",
              },
              {
                type: "radio-group",
                name: "radio",
                id: "radio",
                label: "Radio",
                options: ["radio 1", "radio 2", "radio 3"],
              },
              {
                type: "select",
                name: "select",
                id: "select",
                label: "Select",
                placeholder: "Select",
                value: "select 1",
                options: ["select 1", "select 2", "select 3"],
              },
            ],
            submit: "Submit",
          },
          buttons: [
            {
              text: "Lorem ipsum",
              href: "#",
            },
            {
              text: "Lorem ipsum",
              href: "#",
            },
          ],
          menus: [
            {
              text: "Lorem ipsum",
              href: "#",
              links: [
                {
                  text: "Lorem ipsum",
                  href: "#",
                },
                {
                  text: "Lorem ipsum",
                  href: "#",
                },
              ],
            },
            {
              text: "Lorem ipsum",
              href: "#",
            },
            {
              text: "Lorem ipsum",
              href: "#",
            },
          ],
          person: {
            title: "John Doe",
            tagline: "CEO",
            description:
              "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.",
            avatar: {
              src: "/placeholder.webp",
              alt: "Review 1",
            },
            href: "#",
          },
          published: "2021-01-01",
          items: [
            {
              title: "John Doe",
              tagline: "CEO",
              description:
                "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.",
              rating: 5,
              avatar: {
                src: "/placeholder.webp",
                alt: "Review 1",
              },
              href: "#",
            },
            {
              title: "Jane Doe",
              tagline: "CTO",
              description:
                "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.",
              rating: 5,
              avatar: {
                src: "/placeholder.webp",
                alt: "Review 2",
              },
              href: "#",
            },
            {
              title: "Review 3",
              tagline: "CFO",
              description:
                "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.",
              rating: 5,
              avatar: {
                src: "/placeholder.webp",
                alt: "Review 3",
              },
              href: "#",
            },
          ],
          socials: [
            "https://facebook.com",
            "https://instagram.com",
            "https://twitter.com",
            "https://linkedin.com",
            "https://youtube.com",
            "https://tiktok.com",
          ],
          features: [
            {
              title: "Lorem ipsum",
              description:
                "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.",
            },
            {
              title: "Lorem ipsum",
              description:
                "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.",
            },
            {
              title: "Lorem ipsum",
              description:
                "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.",
            },
          ],
          faqs: [
            {
              question: "Lorem ipsum",
              answer:
                "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.",
            },
            {
              question: "Lorem ipsum",
              answer:
                "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.",
            },
            {
              question: "Lorem ipsum",
              answer:
                "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.",
            },
          ],
        },
        html: "<p>Lorem ipsum</p><h2>Lorem ipsum dolor sit amet</h2><p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>",
      },
    }
  })
}

const { value, id, data, html } = Astro.props
const Comp = ((await value?.()) as any)?.default

const options = [
  {
    name: "size",
    value: "default",
    options: ["sm", "default", "lg"],
  },
  {
    name: "variant",
    value: "default",
    options: ["default", "outline", "muted"],
  },
  {
    name: "align",
    value: "start",
    options: ["start", "center", "end"],
  },
  {
    name: "frame",
    value: "default",
    options: ["default", "float"],
  },
]

const searchParams = Object.fromEntries(new URLSearchParams(Astro.url.search))
---

<Layout {...data}>
  <Section variant="muted" class="border-b">
    <SectionContent class="py-8">
      <SectionSpread align="center">
        <Typography size="sm">
          <h2>{id}</h2>
        </Typography>
        <div class="flex gap-4">
          {
            options.map((option) => (
              <Field class="w-30 gap-1">
                <FieldLabel for={option.name}>{option.name}:</FieldLabel>
                <Select
                  id={option.name}
                  name={option.name}
                  value={option.value}
                >
                  {option.options.map((value) => (
                    <SelectItem value={value} id={value}>
                      {value}
                    </SelectItem>
                  ))}
                </Select>
              </Field>
            ))
          }
        </div>
      </SectionSpread>
    </SectionContent>
  </Section>
  {
    Comp && (
      <Comp {...data} {...searchParams}>
        <Fragment set:html={html} />
      </Comp>
    )
  }
</Layout>

<script>
  const params = new URLSearchParams(window.location.search)

  // Sync select values with URL params on page load
  document.querySelectorAll("select").forEach((select) => {
    if (params.has(select.name)) {
      select.value = params.get(select.name) ?? ""
    }
  })

  // Update URL when select changes
  document.querySelectorAll("select").forEach((select) => {
    select.addEventListener("change", () => {
      const currentParams = new URLSearchParams(window.location.search)
      document.querySelectorAll("select").forEach((sel) => {
        currentParams.set(sel.name, sel.value)
      })

      window.location.href = `?${currentParams.toString()}`
    })
  })
</script>
