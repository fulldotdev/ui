---
import { getCollection, getEntry, render } from "astro:content"

import { pageProps } from "@/schemas/page"
import { getHref } from "@/lib/get-href"
import CmsLayout from "@/components/cms/cms-layout"
import Layout from "@/components/layout.astro"

export async function getStaticPaths() {
  const pages = await getCollection("pages")
  return pages.map((page) => {
    const href = getHref(page)
    return {
      params: {
        page: href === "/" ? undefined : href,
      },
      props: page,
    }
  })
}

const props = Astro.props
const { Content } = await render(Astro.props)
// const indexLayout = await getEntry("layouts", "index")
// const typeLayout = page.type && (await getEntry("layouts", page.type))
---

<Layout>
  <CmsLayout client:load {...props} body={props.rendered?.html}>
    <Content />
  </CmsLayout>
</Layout>
