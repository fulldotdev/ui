---
import { getCollection, getEntry, render } from "astro:content"

import { getHref } from "@/lib/get-href"
import ContentBlock from "@/components/blocks/content.astro"
import Layout from "@/components/layout.astro"
import Section from "@/components/section.astro"

export async function getStaticPaths() {
  const entries = await getCollection("pages")
  const indexLayout = await getEntry("layouts", "index")
  const entryLayout = await getEntry("layouts", "collections")

  return entries.map((entry) => {
    return {
      params: {
        page: getHref(entry),
      },
      props: {
        entry,
        indexLayout,
        entryLayout,
      },
    }
  })
}

const { entry, indexLayout, entryLayout } = Astro.props
const { sections, seo } = entry.data

const { Content } = await render(Astro.props.entry)
---

<Layout {...indexLayout?.data} {...entryLayout?.data} seo={seo}>
  {
    Content && (
      <ContentBlock {...entry.data}>
        <Content />
      </ContentBlock>
    )
  }
  {sections?.map((section) => <Section {...section} />)}
</Layout>
