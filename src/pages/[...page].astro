---
import { getCollection, render } from "astro:content"

import { getHref } from "@/lib/get-href"
import Block from "@/components/block.astro"
import Layout from "@/components/layout.astro"

export async function getStaticPaths() {
  const pages = await getCollection("pages")
  return pages.map((page) => {
    const href = getHref(page)
    return {
      params: {
        page: href === "/" ? undefined : href,
      },
      props: page,
    }
  })
}

const { sections, ...data } = Astro.props.data
const { Content } = await render(Astro.props)
---

<Layout {...data}>
  <Block {...data} id="page">
    <Content />
  </Block>
  {
    sections?.map((section, index) => (
      <Block {...section} id={`section-${index + 1}`}>
        <Content />
      </Block>
    ))
  }
</Layout>
