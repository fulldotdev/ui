---
import { Footer } from '@/blocks/footer'
import { Header } from '@/blocks/header'
import Block from '@/components/block.astro'
import Layout from '@/components/layout.astro'
import settings from '@/data/settings.json'
import { getHref } from '@/lib/get-href'
import { getCollection, render } from 'astro:content'

export async function getStaticPaths() {
  const articles = await getCollection('articles')
  const collections = await getCollection('collections')
  const pages = await getCollection('pages')
  const persons = await getCollection('persons')
  const products = await getCollection('products')
  const projects = await getCollection('projects')
  const entries = [...pages, ...articles, ...collections, ...products, ...projects, ...persons]

  return entries.map((entry) => ({
    params: {
      page: getHref(entry.collection, entry.id),
    },
    props: entry,
  }))
}

const { Content } = await render(Astro.props)
const { sections, meta, type, ...restData } = Astro.props.data
const { banner, header, footer, ...restSettings } = settings
---

<Layout
  {...restSettings}
  {...restData}
  {...meta}
>
  <Header
    client:load
    {...header}
  />
  <main>
    <Block
      {type}
      {...restData}
    >
      <Content />
    </Block>
    {sections?.map((section) => <Block {...section} />)}
  </main>
  <Footer {...footer} />
</Layout>
