---
import BaseLayout from "@/layouts/base-layout.astro"
import { getCollection, getEntry, render } from "astro:content"

import { getHref } from "@/lib/get-href"

export async function getStaticPaths() {
  const pages = await getCollection("pages")
  return pages.map((page) => ({
    params: {
      page: getHref(page.id) === "/" ? undefined : getHref(page.id),
    },
    props: {
      page,
      search: pages.map((page) => ({
        text: page.data.title,
        href: getHref(page.id),
      })),
    },
  }))
}

const { page, search } = Astro.props
const { id, filePath } = page
const { Content } = await render(page)
const { seo, layout, sections: pageSections, ...pageData } = page.data
const {
  data: { banner, header, footer, company, lang, sections: layoutSections },
} = layout && (await getEntry(layout))
---

<BaseLayout
  id={id}
  filePath={filePath}
  banner={banner}
  header={header}
  footer={footer}
  search={search}
  company={company}
  lang={lang}
  sections={[...(pageSections ?? []), ...(layoutSections ?? [])]}
  {...pageData}
  {...seo}
>
  <Content />
</BaseLayout>
