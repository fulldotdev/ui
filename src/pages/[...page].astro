---
import { getCollection, render } from "astro:content"

import { Block } from "@/components/block.tsx"
import Layout from "@/components/layout.astro"

export async function getStaticPaths() {
  const pages = await getCollection("pages")
  return pages.map((page) => {
    return {
      params: {
        page: page.id === "index" ? undefined : page.id,
      },
      props: page,
    }
  })
}

const { Content } = await render(Astro.props)
const { sections, ...data } = Astro.props.data
---

<Layout {...data}>
  {
    blocks?.map(({ html, ...block }, i) => (
      <Block client:load key={i} {...block}>
        {block.html && <Fragment set:html={block.html} />}
      </Block>
    ))
  }
</Layout>
