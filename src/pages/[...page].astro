---
import { getCollection } from 'astro:content'
import PageLayout from 'fulldev-ui/layouts/PageLayout.astro'

export async function getStaticPaths() {
  const pages = await getCollection('pages')
  return pages.map((page) => ({
    params: {
      page: page.slug === 'index' ? undefined : page.slug,
    },
    props: page,
  }))
}

const { data, ...rest } = Astro.props
const { component, ...restData } = data

const layouts = {
  ...import.meta.glob('/src/layouts/**/*.astro'),
  ...import.meta.glob('../layouts/**/*.astro'),
}

const componentPath = Object.keys(layouts).find((path) => {
  const strip = (str?: string) => str?.split('/').pop()?.split('.')[0]
  return strip(path) === strip(component)
})

const Component =
  (componentPath && (await (layouts[componentPath] as any)()).default) ??
  PageLayout
---

<Component
  {...restData}
  {...rest}
/>
