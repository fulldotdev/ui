---
// This page is used for dynamic page building.
// It is still experimental and not yet documented or included within fulldev/ui.
import { getCollection, getEntry, render } from "astro:content"
import config from "site.json"

import Layout from "@/components/layout.astro"

export async function getStaticPaths() {
  const pages = await getCollection("pages")
  return pages.map((page) => {
    return {
      params: {
        page: page.id === "index" ? undefined : page.id,
      },
      props: page,
    }
  })
}

const { layout, ...page } = Astro.props.data
const { Content } = await render(Astro.props)

const indexLayout = (await getEntry("layouts", "index"))?.data
const pageLayout = layout
  ? (await getEntry("layouts", layout))?.data
  : undefined
---

<Layout
  {...config}
  {...indexLayout}
  {...pageLayout}
  {...page}
  {...indexLayout?.seo}
  {...pageLayout?.seo}
  {...page?.seo}
  sections={[
    ...(page?.sections || []),
    ...(pageLayout?.sections || []),
    ...(indexLayout?.sections || []),
  ]}
>
  <Content />
</Layout>
