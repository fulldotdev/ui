---
import { getCollection, getEntry, render } from "astro:content"

import { getHref } from "@/lib/get-href"
import { getSlug } from "@/lib/get-slug"
import Layout from "@/components/misc/layout.astro"
import Page from "@/components/misc/page.astro"

export async function getStaticPaths() {
  const pages = await getCollection("pages")
  return pages.map((page) => {
    return {
      params: {
        page: getSlug(page),
      },
      props: {
        page: page,
        search: pages.map((page) => ({
          text: page.data.title,
          href: getHref(page),
        })),
      },
    }
  })
}

const { page, search } = Astro.props

const layoutReference = page.data.layout || {
  collection: "layouts",
  id: "base",
}

const layout = await getEntry(layoutReference)
---

<Layout {...layout?.data} {...page.data} {...page.data.seo} search={search}>
  <Page {...page} />
</Layout>
