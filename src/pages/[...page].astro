---
import { getCollection } from "astro:content"
import { mergeAll } from "remeda"

import { getHref } from "@/lib/get-href"
import Block from "@/components/block.astro"
import Layout from "@/components/layout.astro"

import "@/styles/globals.css"

export async function getStaticPaths() {
  const pages = await getCollection("pages")
  return pages.map((page) => {
    return {
      params: {
        page: getHref(page),
      },
      props: page,
    }
  })
}

const { id } = Astro.props
const { seo, sections, ...page } = Astro.props.data

const layoutEntry = mergeAll(
  await getCollection(
    "layouts",
    (layout) => layout.id === "index" || id.startsWith(layout.id)
  )
)

const layout = "data" in layoutEntry ? layoutEntry.data : undefined
---

<Layout {...layout} seo={seo}>
  {sections?.map((section) => <Block {...section} />)}
</Layout>
