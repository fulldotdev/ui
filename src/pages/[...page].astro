---
import { getCollection, getEntry, render } from 'astro:content'
import Block from 'fulldev-ui/components/Block.astro'
import Element from 'fulldev-ui/components/Element.astro'
import Layout from 'fulldev-ui/structures/Layout.astro'
import { getHref } from 'fulldev-ui/utils/getHref'

export async function getStaticPaths() {
  const collection = await getCollection('pages')
  return collection.map((entry) => {
    const slug = entry.data.slug ?? entry.id
    return {
      params: {
        page: getHref(slug),
      },
      props: entry,
    }
  })
}

const page = Astro.props.data
const general = (await getEntry('globals', 'general'))?.data
const header = (await getEntry('globals', 'header'))?.data
const footer = (await getEntry('globals', 'footer'))?.data
const { Content, headings } = await render(Astro.props)
---

<Layout
  {...page}
  {...general}
>
  <Block
    {...general}
    {...header}
  />
  <Element as="main">
    <Block
      {headings}
      {...general}
      {...page}
    >
      <Content />
    </Block>
    {page.sections?.map((section) => <Block {...section} />)}
  </Element>
  <Block
    {...general}
    {...footer}
  />
</Layout>
