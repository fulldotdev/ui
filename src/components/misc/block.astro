---
import { Banner1 } from "@/blocks/banner-1"
import { Collection1 } from "@/blocks/collection-1"
import { Collections1 } from "@/blocks/collections-1"
import { Contact1 } from "@/blocks/contact-1"
import { Contact2 } from "@/blocks/contact-2"
import { Content1 } from "@/blocks/content-1"
import { Cta1 } from "@/blocks/cta-1"
import { Faqs1 } from "@/blocks/faqs-1"
import { Faqs2 } from "@/blocks/faqs-2"
import { Features1 } from "@/blocks/features-1"
import { Footer1 } from "@/blocks/footer-1"
import { Header1 } from "@/blocks/header-1"
import { Header2 } from "@/blocks/header-2"
import { Hero1 } from "@/blocks/hero-1"
import { Hero2 } from "@/blocks/hero-2"
import { Hero3 } from "@/blocks/hero-3"
import { Locations1 } from "@/blocks/locations-1"
import { Media1 } from "@/blocks/media-1"
import { Media2 } from "@/blocks/media-2"
import { Pages1 } from "@/blocks/pages-1"
import { Persons1 } from "@/blocks/persons-1"
import { Post1 } from "@/blocks/post-1"
import { Posts1 } from "@/blocks/posts-1"
import { Pricings1 } from "@/blocks/pricings-1"
import { Product1 } from "@/blocks/product-1"
import { Products1 } from "@/blocks/products-1"
import { Reviews1 } from "@/blocks/reviews-1"
import config from "@/data/config.json"
import { getCollection, getEntries } from "astro:content"
import type { AnyEntryMap } from "astro:content"

import { getHref } from "@/lib/get-href"

type Props = {
  content: {
    pages?: Parameters<typeof getEntries>[0]
    posts?: Parameters<typeof getEntries>[0]
    products?: Parameters<typeof getEntries>[0]
    projects?: Parameters<typeof getEntries>[0]
    persons?: Parameters<typeof getEntries>[0]
    collections?: Parameters<typeof getEntries>[0]
    reviews?: Parameters<typeof getEntries>[0]
    locations?: Parameters<typeof getEntries>[0]
  }
  type?: string
  variant?: number
  id?: string
  content?: string
  posts?: Parameters<typeof getEntries>[0]
  products?: Parameters<typeof getEntries>[0]
  projects?: Parameters<typeof getEntries>[0]
  persons?: Parameters<typeof getEntries>[0]
  collections?: Parameters<typeof getEntries>[0]
  reviews?: Parameters<typeof getEntries>[0]
  locations?: Parameters<typeof getEntries>[0]
  [key: string]: any
}

let {
  id,
  type,
  variant = 1,
  content,
  pages,
  posts,
  products,
  projects,
  persons,
  collections,
  reviews,
  locations,
  ...props
} = Astro.props

async function getRightEntries(
  collection: string,
  value: undefined | Parameters<typeof getEntries>[0]
) {
  if (value) return await getEntries(value)

  const currentPageSlug = Astro.params.page
  const matchingCollection = Object.entries(config.content).find(
    ([_, value]) => value.slug === currentPageSlug
  )
  const matchingKey = matchingCollection?.[0] as keyof AnyEntryMap
  const childrenCollection = matchingKey && (await getCollection(matchingKey))
  if (childrenCollection && childrenCollection.length > 0)
    return childrenCollection

  return await getCollection(collection as keyof AnyEntryMap)
}

function MapEntries(entries: any[]) {
  return entries.map((entry) => ({
    href: getHref(entry.collection, entry.id),
    image: "images" in entry.data ? entry.data.images?.[0] : undefined,
    ...entry.data,
  }))
}

const pageEntries = await getRightEntries("pages", pages)
const postEntries = await getRightEntries("posts", posts)
const productEntries = await getRightEntries("products", products)
const personEntries = await getRightEntries("persons", persons)
const reviewEntries = await getRightEntries("reviews", reviews)
const projectEntries = await getRightEntries("projects", projects)
const collectionEntries = await getRightEntries("collections", collections)
const locationEntries = await getRightEntries("locations", locations)

const productInCollectionEntries = (await getCollection("products"))?.filter(
  (product) =>
    product?.data?.collections?.find((reference) => reference.id === id)
)
---

{
  (type === "post" ||
    type === "location" ||
    type === "person" ||
    type === "project") &&
    variant === 1 && (
      <Post1 {...props}>
        <slot />
      </Post1>
    )
}

{
  type === "collection" && variant === 1 && (
    <Collection1
      client:load
      products={MapEntries(productInCollectionEntries)}
      {...props}
    >
      <slot />
    </Collection1>
  )
}

{
  type === "product" && variant === 1 && (
    <Product1 client:load {...props}>
      <slot />
    </Product1>
  )
}

{
  type === "page" && variant === 1 && (
    <Content1 {...props}>
      <slot />
    </Content1>
  )
}

{
  type === "posts" && variant === 1 && (
    <Posts1 posts={MapEntries(postEntries)} {...props} />
  )
}

{
  type === "projects" && variant === 1 && (
    <Posts1 posts={MapEntries(projectEntries)} {...props} />
  )
}

{
  type === "pages" && variant === 1 && (
    <Pages1 pages={MapEntries(pageEntries)} {...props} />
  )
}

{
  type === "products" && variant === 1 && (
    <Products1 products={MapEntries(productEntries)} {...props} />
  )
}
{
  type === "persons" && variant === 1 && (
    <Persons1 persons={MapEntries(personEntries)} {...props} />
  )
}
{
  type === "collections" && variant === 1 && (
    <Collections1 collections={MapEntries(collectionEntries)} {...props} />
  )
}
{
  type === "reviews" && variant === 1 && (
    <Reviews1 reviews={MapEntries(reviewEntries)} {...props} />
  )
}
{
  type === "locations" && variant === 1 && (
    <Locations1 locations={MapEntries(locationEntries)} {...props} />
  )
}

{type === "banner" && variant === 1 && <Banner1 {...props} />}

{type === "header" && variant === 1 && <Header1 client:load {...props} />}
{type === "header" && variant === 2 && <Header2 client:load {...props} />}

{type === "footer" && variant === 1 && <Footer1 {...props} />}

{type === "contact" && variant === 1 && <Contact1 {...props} />}
{type === "contact" && variant === 2 && <Contact2 {...props} />}

{type === "cta" && variant === 1 && <Cta1 {...props} />}

{type === "faqs" && variant === 1 && <Faqs1 client:load {...props} />}
{type === "faqs" && variant === 2 && <Faqs2 client:load {...props} />}

{type === "features" && variant === 1 && <Features1 {...props} />}

{type === "hero" && variant === 1 && <Hero1 {...props} />}
{type === "hero" && variant === 2 && <Hero2 {...props} />}
{type === "hero" && variant === 3 && <Hero3 {...props} />}

{type === "media" && variant === 1 && <Media1 {...props} />}
{type === "media" && variant === 2 && <Media2 {...props} />}

{type === "pricings" && variant === 1 && <Pricings1 {...props} />}
