---
import '@/styles/global.css'
import { SEO } from 'astro-seo'

interface Props {
  company?: string | null
  title?: string | null
  description?: string | null
  image?: {
    src?: string | null
    alt?: string | null
  } | null
  canonical?: string | null
  noindex?: boolean | null
  nofollow?: boolean | null
}

const { company, title, description, image, canonical, noindex, nofollow } = Astro.props

// TODO: shadcn theme switcher
const theme = 'light'
---

<head>
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1"
  />
  <meta
    name="generator"
    content={Astro.generator}
  />
  <SEO
    charset="UTF-8"
    title={title || undefined}
    description={description || description || undefined}
    noindex={noindex || undefined}
    nofollow={nofollow || undefined}
    canonical={canonical || Astro.url.href}
    openGraph={{
      basic: {
        title: title || '',
        image: Astro.url.origin + image?.src,
        type: 'website',
        url: Astro.url.href,
      },
      image: {
        url: Astro.url.origin + image?.src,
        alt: image?.alt || title || title || company || undefined,
      },
      optional: {
        description: description || undefined,
        siteName: company || undefined,
      },
    }}
  />

  <slot />

  <!-- Light / Dark theme -->
  <script is:inline define:vars={{ theme }}>
    function setTheme(document) {
      const value = localStorage.getItem('theme') || theme

      const isDark =
        value === 'dark' || (value === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)

      document.documentElement.classList.toggle('dark', isDark)

      document.querySelectorAll('.themer').forEach((themer) => {
        themer?.querySelectorAll('option').forEach((option) => {
          option.selected = option.value === value
        })
      })
    }

    function setOption(document) {
      const value = localStorage.getItem('theme') || theme

      document.querySelectorAll('.themer').forEach((themer) => {
        themer?.querySelectorAll('option').forEach((option) => {
          option.selected = option.value === value
        })
      })
    }

    setTheme(document)
    setOption(document)

    document.addEventListener('astro:before-swap', (event) => {
      setTheme(event.newDocument)
    })

    document.addEventListener('astro:page-load', () => {
      setOption(document)
    })
  </script>
</head>
