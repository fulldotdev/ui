---
import { getEntries } from 'astro:content'
import type { BlockSchema } from 'fulldev-ui/schemas/block'

interface Props extends BlockSchema {}

let { _block, cards, pages, records, ...rest } = Astro.props

const blocks = {
  ...import.meta.glob('/src/blocks/**/*.astro'),
  ...import.meta.glob('../blocks/**/*.astro'),
}

const path = Object.keys(blocks).find(
  (path) => path.split('/').pop()?.split('.')[0] === _block
)

const BlockComponent = path && (await (blocks[path] as any)()).default

cards = [
  ...(cards || []),
  ...(await getEntries(records || [])).map(({ data, ...rest }) => ({
    ...data,
    ...rest,
  })),
  ...(await getEntries(pages || [])).map(({ data, ...rest }) => ({
    ...rest,
    ...data,
  })),
]
---

{
  BlockComponent && (
    <BlockComponent
      {cards}
      {...rest}
    >
      <slot />
    </BlockComponent>
  )
}
