---
import type { ComponentProps, HTMLTag, Polymorphic } from 'astro/types'
import Column from 'fulldev-ui/components/Column.astro'
import Heading from 'fulldev-ui/components/Heading.astro'
import Link from 'fulldev-ui/components/Link.astro'
import Root from 'fulldev-ui/components/Root.astro'
import Text from 'fulldev-ui/components/Text.astro'
import Logo from 'fulldev-ui/components/experimental/Logo.astro'
import Button from './Button.astro'
import Row from './Row.astro'
import Social from './Social.astro'
import Spread from './Spread.astro'
import Stack from './Stack.astro'
import Channel from './experimental/Channel.astro'

type Props<As extends HTMLTag = 'footer'> = Polymorphic<{ as: As }> & {
  size?: 'sm' | 'md' | 'lg' | undefined
  theme?: 'light' | 'dark' | undefined
  color?: 'base' | 'brand' | undefined
  space?: 'none' | 'auto' | undefined
  screen?: number | undefined
  logo?: string | undefined
  heading?: string | undefined
  title?: string | undefined
  description?: string | undefined
  hours?: any
  text?: string | undefined
  socials?: (string | ComponentProps<typeof Social>)[] | undefined
  buttons?: ComponentProps<typeof Button<'a'>>[] | undefined
  html?: string | undefined
  panel?: boolean | undefined
  channels?: any
  columns?: {
    heading: string | undefined
    links: ComponentProps<typeof Link<'a'>>[] | undefined
  }[]
}

const {
  as = 'footer',
  space = 'auto',
  size = 'sm',
  screen = 1280,
  hours,
  panel,
  logo,
  socials,
  heading,
  buttons,
  columns,
  text,
  title,
  description,
  channels,
  html,
  ...rest
} = Astro.props
---

<Root
  class:list="footer"
  style={{ '--screen': `${screen}px` }}
  structure="stack"
  {as}
  {panel}
  {space}
  {size}
  {...rest}
>
  <Column>
    <Logo {logo} />
    <Text
      color="base"
      html={html || text || description}
    />
    <Row>
      {
        socials?.map((social) => (
          <Social
            {...(typeof social === 'string' ? { href: social } : social)}
          />
        ))
      }
    </Row>
  </Column>

  <Column
    space="none"
    class:list="channels"
  >
    {
      channels?.map((channel: any) => (
        <Channel
          heading={channel.heading}
          text={channel.text}
          icon={channel.icon}
          href={channel.href}
        />
      ))
    }
  </Column>

  <Column
    class:list="hours"
    space="none"
  >
    <Heading
      html={hours?.heading}
      level={5}
    />
    <Column space="none">
      {
        Object.entries(hours?.days ?? {})?.map(([key, value]: any) => (
          <Spread>
            <Text text={key} />
            <Text text={value} />
          </Spread>
        ))
      }
    </Column>
  </Column>

  <Stack class:list="buttons">
    {
      columns?.map(({ heading, buttons }: any) => (
        <Column>
          <Heading
            level={5}
            html={heading}
          />
          {buttons?.map((button: any) => (
            <Button
              variant="link"
              {...button}
            />
          ))}
        </Column>
      ))
    }
  </Stack>
</Root>

<style is:global lang="scss">
  @layer fulldev {
    .footer {
      position: relative;
      margin-top: auto;
      border-top-width: 1px;
      border-color: var(--base-a6);
      background-color: var(--base-2);
      padding: var(--space-7) var(--gutter);
      width: 100%;
      overflow: auto;

      .column {
        h5 + * {
          margin-top: var(--space-4);
        }

        .button.variant-link + .button.variant-link {
          margin-top: var(--space-4);
        }
      }

      &.panel {
        margin: var(--spacer) var(--gutter);
        border-width: 1px;
        border-radius: var(--radius-2);
        overflow: hidden;
      }

      .channels {
        gap: var(--space-3);
      }

      .buttons {
        gap: var(--space-3);
      }

      .text {
        max-width: calc(5 * var(--space-7));
      }

      .hours {
        .column {
          gap: 0;

          .text {
            font-size: var(--text-2);
          }
        }
      }
    }
  }
</style>
