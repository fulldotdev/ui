---
import type { HTMLAttributes } from 'astro/types'
import Element from 'fulldev-ui/components/Element.astro'
import Icon from 'fulldev-ui/components/Icon.astro'
import type { GlobalProps } from 'fulldev-ui/types/global-props'
import Avatars from './Avatars.astro'

interface Props extends GlobalProps, HTMLAttributes<'div'> {
  align?: 'start' | 'center' | 'end' | undefined
  value?: number | undefined
  text?: string | undefined
  avatars?: any
  avatar?: any
}

const {
  size = 'md',
  value,
  text,
  avatars,
  avatar,
  align,
  ...rest
} = Astro.props

const getIcon = (count: number) => {
  if (!value) return
  const difference = value - count
  if (difference >= -0.25) return 'star-filled'
  if (difference >= -0.75) return 'star-half-filled'
  return 'star'
}
---

<Element
  class:list="rating"
  {size}
  {...rest}
>
  <Avatars
    {size}
    {avatars}
    {avatar}
  />
  <Element class:list="rating-content">
    <Element
      class:list="rating-stars"
      {...rest}
    >
      {
        value &&
          [1, 2, 3, 4, 5].map((_, i) => (
            <Icon
              {size}
              name={getIcon(i + 1)}
              class:list={'rating-icon-solid'}
            />
          ))
      }
    </Element>
    <Fragment set:html={text} />
    <slot />
  </Element>
</Element>

<style is:global>
  @layer fulldev {
    .rating {
      @apply flex items-center gap-3;

      .rating-content {
        @apply flex flex-col gap-1 text-muted-foreground;
      }

      .rating-stars {
        @apply flex gap-1 text-primary;
      }

      &.size-sm {
        @apply gap-2;

        .rating-content {
          @apply text-xs leading-none;
        }
      }

      &.size-md {
        @apply gap-2.5;

        .rating-content {
          @apply text-sm leading-none;
        }
      }

      &.size-lg {
        @apply gap-3;

        .rating-content {
          @apply text-base leading-none;
        }
      }
    }
  }
</style>
