---
import type { ComponentProps, HTMLAttributes } from 'astro/types'
import Button from 'fulldev-ui/components/Button.astro'
import Element from 'fulldev-ui/components/Element.astro'
import Logo from 'fulldev-ui/components/Logo.astro'
import Menu from 'fulldev-ui/components/Menu.astro'
import type { GlobalProps } from 'fulldev-ui/types/global-props'
import Buttons from './Buttons.astro'
import Heading from './Heading.astro'

interface Props extends GlobalProps, HTMLAttributes<'aside'> {
  variant?: ComponentProps<typeof Button>['variant']
  text?: ComponentProps<typeof Button>['text']
  icon?: ComponentProps<typeof Button>['icon']
  heading?: ComponentProps<typeof Heading>['text']
  logo?: ComponentProps<typeof Logo> | undefined
  company?: ComponentProps<typeof Logo>['company']
  menu?: ComponentProps<typeof Menu>['groups']
  buttons?: ComponentProps<typeof Buttons>['buttons']
}

const {
  id = 'drawer',
  size = 'sm',
  icon = 'menu-2',
  color,
  variant,
  text,
  buttons,
  heading,
  logo,
  company,
  menu,
  if: ifProp,
  ...rest
} = Astro.props

const buttonsGroup = { heading: '', buttons: buttons }
const mergedMenu = [buttonsGroup, ...(menu || [])] as typeof menu
---

<Button
  variant="secondary"
  class:list={['drawer-button', `${id}-button`]}
  onclick={`document.getElementById('${id}').showModal()`}
  {variant}
  {text}
  {icon}
  {color}
/>

<Element
  onclick={`event.target === this && this.close()`}
  class:list="drawer"
  as="dialog"
  {id}
  {text}
  {icon}
  {...rest}
>
  <Element class:list="drawer-body">
    <Element
      class:list="drawer-header"
      as="header"
    >
      <Logo
        {company}
        {...logo}
      />
      <Heading
        level={4}
        text={heading}
      />
      <Button
        variant="secondary"
        icon="x"
        onclick={`document.getElementById('${id}').close()`}
      />
      <slot name="header" />
    </Element>
    <Element class:list="drawer-content">
      <Menu groups={mergedMenu} />
      <slot />
    </Element>
    <Element
      class:list="drawer-footer"
      as="footer"
    >
      <slot name="footer" />
    </Element>
  </Element>
</Element>

<style  is:global>
  @layer fulldev {
    body:has(dialog[open]) {
      overflow: hidden;

      @media (min-width: 768px) {
        overflow: auto;
      }
    }

    .drawer {
      top: 0;
      bottom: 0;
      margin: 0;
      padding: 0;
      width: 100%;
      max-width: 100%;
      height: 100%;
      max-height: 100%;

      @media (min-width: 768px) {
        width: 440px;
      }

      &::backdrop {
        cursor: pointer;
        background: rgba(0, 0, 0, 0.5);
      }

      .drawer-body {
        display: flex;
        flex-shrink: 1;
        flex-direction: column;
        border-right: 1px solid var(--color-a6);
        height: 100%;
        overflow: auto;
      }

      .drawer-content {
        display: flex;
        flex-direction: column;
        padding: var(--space-6) var(--gutter);
      }

      .drawer-header,
      .drawer-footer {
        display: flex;
        position: sticky;
        flex-shrink: 0;
        z-index: 1;
        border-style: solid;
        border-color: var(--color-a6);
        background-color: var(--base-background);
      }

      .drawer-header {
        top: 0;
        align-items: center;
        border-bottom-width: 1px;
        padding: 0 var(--gutter);
        height: 56px;

        .button {
          margin-left: auto;
        }
      }

      .drawer-footer {
        bottom: 0;
        flex-direction: column;
        margin-top: auto;
        border-top-width: 1px;
        padding: var(--space-5) var(--gutter);
      }
    }
  }
</style>
