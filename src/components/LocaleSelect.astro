---
import Select from 'fulldev-ui/components/Select.astro'

const { ...rest } = Astro.props
---

{
  Astro.props.locales && (
    <Select
      name="locale-switcher"
      options={Astro.props.locales}
      value={Astro.props.lang as string}
      placeholder={Astro.props.lang as string}
      {...rest}
    />
  )
}

<script>
  const select = document.querySelector('select[name="locale-switcher"]')
  select?.addEventListener('change', (event) => {
    if (event.target instanceof HTMLSelectElement) {
      const selectedLocale = event.target.value
      const currentPath = window.location.pathname
      const newPath = `/${selectedLocale}${currentPath.replace(/^\/[^/]+/, '')}`
      window.location.href = new URL(newPath, window.location.href).toString()
    }
  })
</script>
