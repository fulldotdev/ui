---
import Element from 'fulldev-ui/components/Element.astro'
import Image from 'fulldev-ui/components/Image.astro'

const { images } = Astro.props
---

<script>
  const setupGallery = (document: Document) => {
    const galleries = document.querySelectorAll('.gallery')

    galleries.forEach((gallery) => {
      const carousel = gallery.querySelector('.large-carousel')
      const smallImages = gallery.querySelectorAll('.small-image')

      carousel &&
        smallImages?.forEach((image, i) => {
          image.addEventListener('click', () => {
            const largeImages = carousel.querySelectorAll('.large-image')
            if (largeImages[i]) {
              largeImages[i].scrollIntoView({
                behavior: 'smooth',
                block: 'nearest',
                inline: 'start',
              })
            }
          })
        })
    })
  }

  setupGallery(document)

  document.addEventListener('astro:before-swap', (event) => {
    setupGallery(event.newDocument)
  })
</script>

<Element class:list={['gallery']}>
  <Element class="large-carousel">
    {
      images?.map((image: any) => (
        <Image
          class="large-image"
          {...(typeof image === 'string' ? { src: image } : image)}
        />
      ))
    }
  </Element>
  <Element class="small-carousel">
    {
      images?.length > 1 &&
        images.map((image: any) => (
          <Image
            class="small-image"
            {...(typeof image === 'string' ? { src: image } : image)}
          />
        ))
    }
  </Element>
</Element>

<style is:global lang="scss">
  .gallery {
    display: flex;
    position: relative;
    flex-direction: column;
    gap: var(--space-1) var(--space-4);

    .small-carousel,
    .large-carousel {
      display: flex;
      position: relative;
      align-items: center;
      gap: var(--space-4);
      box-sizing: border-box;
      padding-bottom: var(--space-4);
      width: 100%;
      overflow: auto;
      scroll-behavior: smooth;
      scroll-snap-type: x mandatory;

      > .image {
        flex-grow: 0;
        flex-shrink: 0;
        width: var(--column-width);
        scroll-snap-align: center;
      }
    }

    .large-carousel {
      --column-width: 100%;
    }

    .small-carousel {
      --column-width: var(--space-7);

      .image:hover {
        opacity: 0.8;
        cursor: pointer;
      }
    }
  }
</style>
