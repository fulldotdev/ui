---
import Box from '@/components/Box.astro'
import { cn } from '@/lib/utils'
import type { HTMLAttributes } from 'astro/types'
import { marked } from 'marked'

interface Props extends HTMLAttributes<'div'> {
  size?: 'sm' | 'default' | 'lg' | 'xl' | undefined
  align?: 'start' | 'center' | 'end' | undefined
  markdown?: string | null | undefined
  html?: string | null | undefined
}

const { size = 'default', align = 'start', markdown, html, class: className, ...rest } = Astro.props

const markdownHtml = marked(markdown || '')
---

<Box
  class={cn(
    'writeup',
    'text-foreground flex w-full max-w-screen-md flex-col',
    'headings:scroll-mt-20 headings:text-pretty headings:font-semibold headings:tracking-tight headings:text-foreground',
    'p:max-w-[85%] p:text-pretty p:leading-[1.75]',
    'lead:leading-[1.75]',
    'list:my-6 list:ml-4 ul:list-disc list:li:mt-2',
    {
      'headings:text-2xl gap-2 text-sm': size === 'sm',
      'headings:text-4xl gap-4': size === 'default',
      'headings:text-4xl md:headings:text-5xl gap-6 text-lg': size === 'lg',
      'headings:text-5xl md:headings:text-6xl gap-6 text-lg md:text-xl': size === 'xl',
    },
    className
  )}
  {...rest}
>
  <slot name="before" />
  <Fragment set:html={html} />
  <Fragment set:html={markdownHtml} />
  <slot />
</Box>
