---
import type { HTMLAttributes } from "astro/types"

interface Props extends Omit<HTMLAttributes<"svg">, "name" | "href"> {
  href?: HTMLAttributes<"a">["href"]
  name?: string | number
}

const { name, href, ...rest } = Astro.props

const hrefMap = {
  "x.com": "x",
  twitter: "twitter",
  facebook: "facebook",
  instagram: "instagram",
  pinterest: "pinterest",
  youtube: "youtube",
  tiktok: "tiktok",
  snapchat: "snapchat",
  reddit: "reddit",
  tumblr: "tumblr",
  "wa.me": "whatsapp",
  telegram: "telegram",
  discord: "discord",
  vimeo: "vimeo",
  flickr: "flickr",
  yelp: "yelp",
  spotify: "spotify",
  behance: "behance",
  dribbble: "dribbble",
  soundcloud: "soundcloud",
  github: "github",
  twitch: "twitch",
  "tel:": "phone",
  "mailto:": "mail",
  "maps.app.goo.gl": "map-pin",
  linkedin: "linkedin",
} as const

const icons = import.meta.glob([
  "node_modules/lucide-static/icons/*.svg",
  "node_modules/simple-icons/icons/*.svg",
])

// Get the right path from the icons glob
const foundPath = () => {
  let foundPath: string | undefined = undefined
  // For x.com, we use the simple-icons X instead of the lucide-static X, since they overlap
  if (name === "x.com") {
    foundPath = "/node_modules/simple-icons/icons/x.svg"
  } else if (name) {
    foundPath = Object.keys(icons).find((key) => key.includes(`/${name}.svg`))
  } else if (href) {
    const hrefKey =
      Object.keys(hrefMap).find((key) => href.toString().includes(key)) || name
    const hrefValue = hrefMap[hrefKey as keyof typeof hrefMap]
    const foundPath = Object.keys(icons)
      // If href, reverse so that simple-icons takes precedence
      .reverse()
      .find((key) => key.includes(`/${hrefValue}.svg`))
    return foundPath
  }
  // Else return the found path with lucide-icons taking precedence
  return foundPath
}

const foundModule = foundPath() && icons[foundPath() as keyof typeof icons]
const module = foundModule && ((await foundModule()) as any)
const Comp = module?.default
---

{
  Comp && foundPath()?.includes("simple-icons") && (
    <Comp
      height={24}
      width={24}
      fill="currentColor"
      class="size-[1em] text-base"
      {...rest}
    />
  )
}

{
  Comp && foundPath()?.includes("lucide-static") && (
    <Comp height={24} width={24} class="size-[1em] text-base" {...rest} />
  )
}
