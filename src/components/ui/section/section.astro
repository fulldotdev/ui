---
import type { HTMLAttributes } from "astro/types"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

interface Props
  extends HTMLAttributes<"section">,
    VariantProps<typeof variants> {}

const variants = cva(
  [
    "flex flex-col mx-auto gap-y-(--section-py) px-(--section-px) py-(--section-py)",
  ],
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline: "border",
        muted: "bg-muted border-0",
      },
      frame: {
        default: ["w-full"],
        contain: [
          "w-full max-w-[calc(var(--section-width)+2*var(--section-px))] overflow-hidden",
        ],
        float: [
          "w-[calc(100%-16px)] sm:w-[calc(100%-48px)]",
          "bg-muted rounded-4xl my-2 sm:my-6 overflow-hidden",
        ],
        box: [
          "w-[calc(100%-16px)] sm:w-[calc(100%-48px)]",
          "max-w-[calc(var(--section-width)+2*var(--section-px))]",
          "border -mt-px overflow-hidden",
        ],
        panel: [
          "w-[calc(100%-16px)] sm:w-[calc(100%-48px)]",
          "max-w-[calc(var(--section-width)+2*var(--section-px))]",
          "bg-muted rounded-4xl my-2 sm:my-6 overflow-hidden",
        ],
      },
      align: {
        start: "items-start",
        center: "items-center",
        end: "items-end",
      },
      order: {
        default: "",
        reverse: "flex-col-reverse",
      },
    },
    defaultVariants: {
      variant: "default",
      frame: "default",
      order: "default",
    },
  }
)

const {
  class: className,
  variant,
  frame = "float",
  order,
  ...props
} = Astro.props

const slot = await Astro.slots.render("default")
---

{
  slot.trim().length > 0 && (
    <section
      class={cn(variants({ variant, frame, order }), className)}
      data-slot="section"
      data-frame={frame}
      data-order={order}
      {...props}
    >
      <Fragment set:html={slot} />
    </section>
  )
}

<style is:global>
  [data-slot="section"] {
    --section-width: var(--breakpoint-xl);
    --section-py: 48px;
    --section-px: max(24px, calc((100vw - var(--section-width)) / 2));
  }

  [data-slot="section"][data-frame="contain"] {
    --section-px: 24px;
  }

  [data-slot="section"][data-frame="box"],
  [data-slot="section"][data-frame="float"],
  [data-slot="section"][data-frame="panel"] {
    --section-px: 16px;
  }

  @media (min-width: 640px) {
    [data-slot="section"][data-frame="box"],
    [data-slot="section"][data-frame="float"],
    [data-slot="section"][data-frame="panel"] {
      --section-px: 24px;
    }
  }

  @media (min-width: 1280px) {
    [data-slot="section"] {
      --section-py: 96px;
    }

    [data-slot="section"][data-frame="contain"],
    [data-slot="section"][data-frame="box"],
    [data-slot="section"][data-frame="panel"] {
      --section-px: 48px;
    }

    [data-slot="section"][data-frame="float"] {
      --section-px: calc((100vw - var(--section-width)) / 2);
    }
  }
</style>
