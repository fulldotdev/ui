---
import Footer from '@/blocks/Footer.astro'
import Header from '@/blocks/Header.astro'
import BlockComponent from '@/components/Block.astro'
import Element from '@/components/Element.astro'
import Layout from '@/components/Layout.astro'
import { getHref } from '@/lib/getHref'
import type { CollectionEntry } from 'astro:content'
import { getEntries, getEntry, render } from 'astro:content'

interface Props extends CollectionEntry<'blocks'> {}

const { categories, products, ...rest } = Astro.props.data
const { Content } = await render(Astro.props)
const header = (await getEntry('globals', 'header'))?.data
const footer = (await getEntry('globals', 'footer'))?.data

const categoriesEntries =
  categories &&
  (await getEntries(categories)).map((category) => ({
    href: getHref(category),
    ...category.data,
  }))

const productsEntries =
  products &&
  (await getEntries(products)).map((product) => ({
    href: getHref(product),
    ...product.data,
  }))
---

<Layout
  class:list="product"
  {...rest}
>
  <Header {...header} />
  <Element as="main">
    <BlockComponent
      categories={categoriesEntries}
      products={productsEntries}
      {...rest}
    >
      <Content />
    </BlockComponent>
  </Element>
  <Footer {...footer} />
</Layout>

<style>
  .carousel {
    display: flex;
    position: relative;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-height: 80vh;

    .buttons {
      position: absolute;
      bottom: var(--spacing-8);
    }
  }

  .carousel-container {
    display: inline-flex;
    box-sizing: border-box;
    width: 100%;
    overflow-x: scroll;
    scroll-behavior: smooth;
    scroll-snap-type: x mandatory;

    div {
      display: flex;
      flex: none;
      box-sizing: content-box;
      width: 100%;
      scroll-snap-align: center;

      .image {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }
    }

    span {
      position: absolute;
      right: 0;
      bottom: 0;
      background-color: red;
      width: 40px;
      height: 40px;
    }
  }
</style>
