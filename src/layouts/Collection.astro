---
import { Collection1 } from '@/blocks/collection-1'
import Layout from '@/layouts/Layout.astro'
import { getHref } from '@/lib/getHref'
import { getCollection } from 'astro:content'

interface Props {
  id: string
  title?: string
  description?: string
  image?: {
    src: string
    alt: string
  }
  meta?: {
    title?: string
    description?: string
    canonical?: string
    noindex?: boolean
    nofollow?: boolean
  }
}

const { title, description, image, meta, id } = Astro.props

const products = (
  await getCollection('products', ({ data }) => data.collections?.some((collection) => collection.id === id))
)?.map(({ collection, id, data }) => ({
  href: getHref(collection, id),
  title: data.title,
  image: data.images?.[0],
  price: data.price,
}))
---

<Layout
  class="collection"
  {title}
  {description}
  {image}
  {...meta}
>
  <Collection1
    {title}
    {description}
    {products}
  >
    <slot />
  </Collection1>
</Layout>
