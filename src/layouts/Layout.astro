---
import type { HTMLAttributes } from 'astro/types'
import type { CollectionEntry } from 'astro:content'
import Footer from 'fulldev-ui/blocks/Footer.astro'
import Header from 'fulldev-ui/blocks/Header.astro'
import Blocks from 'fulldev-ui/components/Blocks.astro'
import Head from 'fulldev-ui/components/Head.astro'
import Root from 'fulldev-ui/components/Root.astro'
import Sidebar from 'fulldev-ui/components/Sidebar.astro'
import Toc from 'fulldev-ui/components/Toc.astro'

type Props = CollectionEntry<'pages'>['data'] & {
  class?: HTMLAttributes<'body'>['class']
  lang?: HTMLAttributes<'html'>['lang']
  render: CollectionEntry<'pages'>['render']
  theme?: 'light' | 'dark'
}

const {
  lang = 'nl',
  header,
  sidebar,
  sections,
  toc,
  footer,
  render,
  code,
  theme,
} = Astro.props
---

<!doctype html>
<html lang={lang}>
  <Head {...Astro.props} />
  <Root
    as="body"
    {theme}
  >
    <slot name="header">
      <Header {...header} />
    </slot>
    <slot name="sidebar">
      <Sidebar {...sidebar} />
    </slot>
    <slot name="toc">
      <Toc
        {toc}
        {render}
      />
    </slot>
    <main data-pagefind-body>
      <slot>
        <Blocks {...sections} />
      </slot>
    </main>
    <slot name="footer">
      <Footer {...footer} />
    </slot>
    <Fragment set:html={code} />

    <style lang="scss" is:global>
      @layer fulldev {
        html {
          width: 100%;
          height: 100%;
          scroll-behavior: smooth;
          color-scheme: var(--color-scheme);
          font-size: var(--text-2);
          font-family: var(--font-family);
        }

        body {
          --screen: 100vw;
          display: grid;
          grid-template-columns: 1fr;
          background-color: var(--color-background);
          width: 100%;
          height: 100%;
          color: var(--base-11);

          @media (min-width: 1024px) {
            grid-template-columns:
              minmax(0, auto)
              minmax(0, 1fr)
              minmax(0, auto);

            .header ~ .sidebar,
            .header ~ .toc {
              margin-top: var(--header-height);
              height: calc(100vh - var(--header-height));
            }

            .sidebar ~ main {
              margin-left: var(--sidebar-width);
            }

            .toc ~ main {
              margin-right: var(--sidebar-width);
            }

            main {
              --screen: 1280px;

              display: flex;
              grid-column: 2 / 3;
              flex-direction: column;
              padding-top: var(--header-height);
            }
          }
        }
      }
    </style>
  </Root>
</html>
