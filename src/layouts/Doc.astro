---
import type { ComponentProps } from 'astro/types'
import type { CollectionEntry } from 'astro:content'
import Footer from 'fulldev-ui/blocks/Footer.astro'
import Header from 'fulldev-ui/blocks/Header.astro'
import Heading from 'fulldev-ui/components/Heading.astro'
import Menu from 'fulldev-ui/components/Menu.astro'
import Menus from 'fulldev-ui/components/Menus.astro'
import Paragraph from 'fulldev-ui/components/Paragraph.astro'
import type { PageSchema } from 'fulldev-ui/schemas/page.ts'
import Container from 'fulldev-ui/structures/Container.astro'
import Layout from 'fulldev-ui/structures/Layout.astro'
import Prose from 'fulldev-ui/structures/Prose.astro'
import Sidebar from 'fulldev-ui/structures/Sidebar.astro'

type Props = ComponentProps<typeof Layout> &
  PageSchema & {
    render: CollectionEntry<'pages'>['render']
  }

const { header, sidebar, render, title, description, footer } = Astro.props

const { Content, headings } = await render()

const filteredHeadings = headings?.filter(
  (heading: any) => heading.depth >= 2 && heading.depth <= 4
)

const links = filteredHeadings?.map((button: any) => ({
  text: button.text,
  href: `#${button.slug}`,
  class: `depth-${button.depth}`,
}))
---

<Layout
  class:list="doc"
  {...Astro.props}
>
  <Header
    {...sidebar}
    {...header}
  />
  <Container as="main">
    <Sidebar>
      <Menus
        size="sm"
        menus={sidebar?.menus}
      />
    </Sidebar>
    <Container>
      <Prose>
        <Heading
          size="4xl"
          as="h1"
          text={title}
        />
        <Paragraph
          muted
          text={description}
        />
        <Content />
      </Prose>
    </Container>
    <Sidebar class:list="doc-toc">
      <Menu
        size="sm"
        heading={title}
        {links}
      />
    </Sidebar>
  </Container>
  <Footer {...footer} />
</Layout>

<style is:global>
  @layer fulldev {
    .doc {
      main {
        @apply flex w-full items-start justify-between !px-0;
      }

      .sidebar {
        @apply hidden lg:flex;
      }

      .doc-toc {
        @apply hidden xl:flex;
      }

      .prose {
        @apply mx-auto py-8;
      }
    }
  }
</style>
