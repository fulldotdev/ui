---
import Footer from '@/blocks/Footer.astro'
import Header from '@/blocks/Header.astro'
import Block from '@/components/Block.astro'
import Container from '@/components/Container.astro'
import Element from '@/components/Element.astro'
import Image from '@/components/Image.astro'
import Layout from '@/components/Layout.astro'
import Prose from '@/components/Prose.astro'
import Section from '@/components/Section.astro'
import Sidebar from '@/components/Sidebar.astro'
import Toc from '@/components/Toc.astro'
import type { CollectionEntry } from 'astro:content'
import { getEntry, render } from 'astro:content'

interface Props extends CollectionEntry<'posts'> {}

const { title, description, image, blocks, ...rest } = Astro.props.data
const { Content, headings } = await render(Astro.props)
const header = (await getEntry('globals', 'header'))?.data
const footer = (await getEntry('globals', 'footer'))?.data
---

<Layout
  class:list="post"
  {...rest}
>
  <Header {...header} />
  <Element as="main">
    <Section>
      <Container>
        <Prose>
          <Element as="h1">{title}</Element>
          <Element as="p">{description}</Element>
          <Image {...image} />
          <Content />
        </Prose>
        <Sidebar>
          <Toc
            size="sm"
            heading={title}
            {headings}
          />
        </Sidebar>
      </Container>
    </Section>
    {blocks?.map((block) => <Block {...block} />)}
  </Element>
  <Footer {...footer} />
</Layout>
