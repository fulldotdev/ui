---
import { getImage } from 'astro:assets'
import CartForm from 'fulldev-ui/components/CartForm.astro'
import Element from 'fulldev-ui/components/Element.astro'
import Gallery from 'fulldev-ui/components/Gallery.astro'
import Heading from 'fulldev-ui/components/Heading.astro'
import Image from 'fulldev-ui/components/Image.astro'
import List from 'fulldev-ui/components/List.astro'
import Text from 'fulldev-ui/components/Text.astro'

const {
  as = 'section',
  size = 'lg',
  variant = 1,
  level = 1,
  rating,
  tagline,
  badge,
  heading,
  lead,
  paragraph,
  buttons,
  image,
  title,
  list,
  price,
  images,
  text,
  subheading,
  variants,
  button,
  description,
  form,
  uitverkocht,
  ...rest
} = Astro.props

const slug = Astro.url.pathname.replace(/^\/|\/$/g, '') || 'index'
const imageId = images?.[0]?.id
const src = `/src/images/${imageId}`
const allImages = import.meta.glob<{ default: ImageMetadata }>('/src/images/*')
const foundImage = allImages[src]
const gotImage =
  imageId && (await getImage({ src: foundImage ? foundImage() : src }))
---

<Element
  class:list="product"
  structure="split"
  {...rest}
>
  {
    images && images.length > 1 ? (
      <Gallery
        {images}
        direction={gallery}
      />
    ) : (
      <Image {...(image || images?.[0])} />
    )
  }
  <Element class:list="column">
    <Heading
      level={2}
      text={heading || title}
    />
    <Text
      style={{ maxWidth: '420px' }}
      text={text || description}
    />
    <List
      items={list}
      style={{ marginTop: 'var(--space-5)' }}
    />
    <CartForm
      soldout={uitverkocht}
      image={gotImage?.src}
      {title}
      {price}
      {slug}
      {variants}
    />
  </Element>
</Element>

<style is:global>
  .product {
    padding-top: 0px;

    @media (min-width: 1024px) {
      padding-top: var(--space-6);
    }

    .column {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: var(--space-5);
    }

    .row {
      display: flex;
      align-items: center;
      gap: var(--space-5);
    }

    @media (max-width: 1023.99px) {
      .gallery {
        margin-right: calc(-1 * var(--gutter));
        margin-left: calc(-1 * var(--gutter));
        width: calc(100% + (var(--gutter) * 2));

        .small-carousel {
          padding-right: var(--gutter);
          padding-left: var(--gutter);
        }
      }
    }
  }
</style>
